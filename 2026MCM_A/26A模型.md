### 初步的电池连续放电模型

状态变量：电池的荷电状态$S(t)$，即$SOC(t)$。输入变量：电池端的总功率 $P_{\text{total}}(t)$，通常放电为正，充电为负。 控制方程（基于功率平衡和欧姆内阻假设）：

$$
\frac{dS(t)}{dt} = -\frac{I(t)}{Q_{\max}}
$$

$$
I(t) = \frac{V_{oc}(S(t)) - \sqrt{\left[V_{oc}(S(t))\right]^2 - 4 R_i \cdot \frac{P_{\text{total}}(t)}{\eta(t)}}}{2 R_i}
$$

$$
\text{其中：} \quad V_{oc}(S(t)) = a_1 e^{b_1 S(t)} + a_2 e^{b_2 S(t)} + c \left[ S(t) \right]^2
$$

在这个模型中我们假定了内阻，最大容量，OCV-SOC曲线，功率，转化效率都是不变的，同时我们使用的欧姆内阻假设

忽略了电池极化效应和扩散效应。而且没有考虑温度变化和老化情况。

但是对于不同的温度情况，我们可以得到不同的OCV-SOC曲线，不过只是几个离散的温度点。

需要在文章中强调的:

- 二次方程保留了符合放电时的现实情况的较小解。
- 欧姆内阻假设。
- $V_{oc}(S(t))$的拟合方程依据某某论文，优缺点，拟合程度
- 整个微分方程的求解应用四阶/五阶Runge-Kutta方法

### 参数P的确定

为了模拟各种实际使用场景下的耗电量，必须确定手机使用情况对功率的函数。
最简单的模型是考虑各组件的功率相加
$P_{\text{总功耗}} = P_{\text{屏幕}} + P_{\text{CPU}} + P_{\text{网络模块}} + P_{\text{GPS}} + P_{\text{后台功耗}}$

#### 屏幕功耗

 OLED 屏幕总功耗分解：

$$
P_{display} = P_{base} + P_{OLED} + P_{TFT}
$$

像素发光的物理模型：
像素功耗基本式：

$$
P_{OLED} = V_{OLED} \cdot I_{OLED}
$$

亮度与电流的关系：

$$
I_{OLED} = \frac{L}{\eta_{cd/A}}
$$

代入后的像素发光功耗：

$$
P_{OLED} = V_{OLED} \cdot \frac{L}{\eta_{cd/A}}
$$

加入 APL（平均画面亮度）与屏幕面积：

$$
P_{OLED} = APL \cdot A \cdot V_{OLED} \cdot \frac{L}{\eta_{cd/A}}
$$

TFT 背板串联损耗模型：
基本式：

$$
P_{TFT} = APL \cdot A \cdot R_{TFT} \cdot I_{OLED}^2
$$

代入电流表达式：

$$
P_{TFT} = APL \cdot A \cdot R_{TFT} \cdot \left( \frac{L}{\eta_{cd/A}} \right)^2
$$

工程常用线性简化模型（最重要）：

$$
P_{display} = P_{base} + k \cdot APL \cdot L
$$

其中：

- \(P_{base}\)：固定驱动功耗
- \(k\)：等效亮度功耗系数
- \(APL\)：平均画面亮度
- \(L\)：亮度（nits）
  用于电池模型的最终时间函数形式：

$$
P_{display}(t) = P_{base} + k \cdot APL(t) \cdot L(t)
$$

来源：[Power Consumption and Temperature Increase in Large Area Active-Matrix OLED Displays](https://opg.optica.org/jdt/abstract.cfm?uri=jdt-4-1-47&utm_source=copilot.com)以及工程经验模型。
数据：
APL在不同场景下的系数
白屏（测试）	1.0
网页、社交媒体	0.6–0.8
视频（电影）	0.2–0.3
游戏	0.4–0.7
深色模式 UI	0.2–0.3
黑色	0
光强L在不同场景下的系数
**环境照度（lux）→ 系统自动亮度 → L** 串起来：

- 室内：100–300 lux → 系统亮度条 ≈ 30–50% → L≈150–250 nits
- 阴天户外：1000–5000 lux → 系统亮度条 ≈ 70–90% → L≈400–700 nits
- 强烈阳光：>10000 lux → 触发高亮模式 → L≈800–1200+ nits

#### 网络功耗

idle+传输速率
Wi‑Fi 功耗模型（工程常用形式）

$$
P_{\text{WiFi}} = P_{\text{idle}} + \alpha_{\text{rx}} \cdot R_{\text{rx}} + \alpha_{\text{tx}} \cdot R_{\text{tx}}
$$

- $P_{\text{idle}}$：维持连接功耗（约 50–120 mW）
- $R_{\text{rx}}, R_{\text{tx}}$：上下行速率（Mbps）
- $\alpha_{\text{rx}}, \alpha_{\text{tx}}$：单位速率功耗系数（mW/Mbps）
  典型参数（来自论文 + 实测）

| 参数                   | 典型值           |
| ---------------------- | ---------------- |
| $P_{\text{idle}}$    | 60–120 mW       |
| $\alpha_{\text{rx}}$ | 0.5–1.2 mW/Mbps |
| $\alpha_{\text{tx}}$ | 1.0–2.0 mW/Mbps |

**解释**：Wi‑Fi 的功耗几乎与数据速率线性相关，因为发射功率恒定（20 dBm 左右），主要耗电来自基带处理。

#### CPU功耗

idle+CPU使用率相关函数
物理模型：

$$
P_{\text{dyn}} = \alpha C_{\text{eff}} V^2 f
$$

- $f$: 频率
- $V$: 电压（随 DVFS 档位变化）
- $\alpha$: 活动因子（与利用率相关）
- $C_{\text{eff}}$: 等效电容

我们使用

$$
P_{\text{cpu}} = P_{\text{idle}}+(P_{\text{max}}-P_{\text{idle}})u(t)
$$

其中u(t)是CPU使用率

#### GPS功耗

三种状态

正常跟踪卫星：50–120 mW
低功耗模式（导航不需要高频更新）：20–60 mW
关闭：0 mW

$$
P_{\text{GPS}} = 
\begin{cases} 
P_{\text{track}}, & \text{tracking} \\
P_{\text{duty}}, & \text{duty cycle} \\
0, & \text{off}
\end{cases}
$$


#### 后台功耗

### 关机判据

在上面的模型中我们简单地用SOC=0作为关机判据，但下面的方法可能更加合适。
1.考虑端电压小于最低电压时关机
**公式 1：电流表达式**

$$
I(t) = \frac{V_{oc}(S(t)) - \sqrt{V_{oc}^2(S(t)) - 4R_i \cdot \dfrac{P_{\text{total}}(t)}{\eta(t)}}}{2R_i}
$$

**公式 2：端电压定义**

$$
V_{\text{term}}(t) = V_{oc}(S) - R_i \cdot I(t)
$$

**代入后得到的表达式（中间形式）：**

$$
V_{\text{term}}(t) = V_{oc}(S) - \frac{V_{oc}^2(S) - 4R_i \cdot \dfrac{P}{\eta}}{2}
$$

**整理后的最终表达式：**

$$
V_{\text{term}}(t) = \frac{V_{oc}(S) + \sqrt{V_{oc}^2(S) - 4R_i \cdot \dfrac{P}{\eta}}}{2}
$$

2.考虑在最低功耗下，判别式为零时关机。

### 温度修正

#### OCV-SOC曲线

首先对OCV-SOC曲线作简单修正，已知该曲线在-20,0,25,45摄氏度的表达式，我们把所有的温度下的表达式用这四个表达式的加权表达。

#### 功率转化效率

其次考虑功率转化效率的影响，公式如下，来源为工程经验式

$$
\eta(T) = 
\begin{cases}
0.70 + 0.0075(T + 20), & -20 \leq T < 0 \\
0.85 + 0.004T, & 0 \leq T < 25 \\
0.95 + 0.001(T - 25), & 25 \leq T \leq 45
\end{cases}
$$

数据来源：
MDPI Energies（2025）：低温效率显著下降，0°C 比 25°C 低 10–20%。
IEEE（2019）：−20°C 效率下降 30–40%，45°C 略高于常温。
Springer（2021）：高温效率略升，低温效率显著下降。

#### 温度的连续变化

最常见的—阶热模型：

$$
C_{\text{th}} \frac{dT}{dt} = P_{\text{loss}} - \frac{T - T_{\text{amb}}}{R_{\text{th}}}
$$

其中：

$$
P_{\text{loss}} = I^2 R_iT
$$

$C_{\text{th}}$：热容
$R_{\text{th}}$：热阻

### 电阻修正

电阻受开路电压和温度的影响很大。可以采用某某论文中的数据进行经验拟合
